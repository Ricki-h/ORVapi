<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORVapi</title>
    <!-- Adiciona Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Adiciona Toast para notificações -->
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <style>
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .input-field {
            @apply mt-1 block w-full px-4 py-3 rounded-lg
            border-b-2 border-gray-200 
            focus:border-b-indigo-500 focus:outline-none
            transition-all duration-300 bg-gray-50
            hover:bg-gray-100;
        }
        .tab-button {
            @apply px-6 py-3 text-gray-600 font-medium relative
            hover:text-indigo-600 transition-all duration-200;
        }
        .tab-button::after {
            content: '';
            @apply absolute bottom-0 left-0 w-full h-0.5 
            bg-indigo-500 transform scale-x-0 
            transition-transform duration-300;
        }
        .tab-button:hover::after {
            @apply scale-x-100;
        }
        .tab-button.active {
            @apply text-indigo-600;
        }
        .tab-button.active::after {
            @apply scale-x-100;
        }
        .form-group {
            @apply relative;
        }
        .form-group label {
            @apply absolute -top-2.5 left-2 px-2 text-sm
            bg-white text-gray-600 transition-all duration-200;
        }
        .form-group input:focus + label,
        .form-group textarea:focus + label {
            @apply text-indigo-600;
        }
        .file-input {
            @apply block w-full text-sm text-gray-500
            file:mr-4 file:py-2 file:px-4 
            file:rounded-full file:border-0 
            file:text-sm file:font-semibold 
            file:bg-indigo-50 file:text-indigo-700 
            hover:file:bg-indigo-100
            transition-all duration-200;
        }
    </style>
</head>
<body class="bg-gray-50">
    <nav class="bg-white shadow-md">
        <div class="container mx-auto px-6">
            <div class="flex justify-between items-center h-16">
                <h1 class="text-2xl font-bold text-indigo-600">ORVapi</h1>
                <div class="flex space-x-1">
                    <button onclick="showTab('adicionar')" class="tab-button" data-tab="adicionar">Adicionar</button>
                    <button onclick="showTab('buscar')" class="tab-button" data-tab="buscar">Buscar</button>
                    <button onclick="showTab('atualizar')" class="tab-button" data-tab="atualizar">Atualizar</button>
                    <button onclick="showTab('deletar')" class="tab-button" data-tab="deletar">Deletar</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-6">
        <!-- Seção Adicionar -->
        <section id="adicionar" class="tab-content">
            <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-md p-8">
                <h2 class="text-2xl font-bold mb-8 text-gray-800">Adicionar Personagem</h2>
                <form id="add-character-form" class="space-y-6">
                    <div class="grid grid-cols-2 gap-6">
                        <div class="form-group">
                            <input type="text" id="name" name="name" required class="input-field">
                            <label for="name">Nome</label>
                        </div>
                        <div class="form-group">
                            <input type="text" id="constellation" name="constellation" required class="input-field">
                            <label for="constellation">Constelação</label>
                        </div>
                    </div>

                    <div class="form-group">
                        <input type="text" id="race" name="race" required class="input-field">
                        <label for="race">Raça</label>
                    </div>

                    <div class="form-group">
                        <textarea id="description" name="description" required 
                                class="input-field min-h-[120px] resize-none"></textarea>
                        <label for="description">Descrição</label>
                    </div>

                    <div class="grid grid-cols-2 gap-6">
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Imagem 1</label>
                            <input type="file" id="img1" name="img1" accept="image/*" class="file-input">
                        </div>
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Imagem 2</label>
                            <input type="file" id="img2" name="img2" accept="image/*" class="file-input">
                        </div>
                    </div>

                    <button type="submit" 
                            class="w-full bg-indigo-600 text-white py-3 px-4 rounded-lg 
                            hover:bg-indigo-700 transition-colors duration-200
                            transform hover:scale-[1.02] active:scale-[0.98]">
                        Adicionar Personagem
                    </button>
                </form>
            </div>
        </section>

        <!-- Seção Buscar -->
        <section id="buscar" class="tab-content">
            <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-md p-8">
                <h2 class="text-2xl font-bold mb-8 text-gray-800">Buscar Personagens</h2>
                <form id="search-form" class="mb-8">
                    <div class="flex gap-4">
                        <div class="form-group flex-1">
                            <input type="text" id="search-name" name="name" class="input-field">
                            <label for="search-name">Buscar por nome</label>
                        </div>
                        <button type="submit" 
                                class="px-6 py-3 bg-indigo-600 text-white rounded-lg 
                                hover:bg-indigo-700 transition-all duration-200
                                transform hover:scale-[1.02] active:scale-[0.98]">
                            Buscar
                        </button>
                    </div>
                </form>

                <div class="bg-gray-50 rounded-lg p-6">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">Personagens Encontrados</h3>
                    <ul id="characters-list" class="space-y-3"></ul>
                </div>
            </div>
        </section>

        <!-- Seção Atualizar -->
        <section id="atualizar" class="tab-content">
            <!-- Similar ao formulário de adicionar, mas com campos de atualização -->
            <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-sm p-8">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">Atualizar Personagem</h2>
                <form id="update-character-form" class="space-y-6">
                    <!-- Campos similares ao formulário de adicionar -->
                    <div>
                        <label for="update-id" class="block text-sm font-medium text-gray-700">ID do Personagem:</label>
                        <input type="text" id="update-id" name="id" required 
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    
                    <!-- Outros campos similares ao formulário de adicionar -->
                    <div>
                        <label for="update-name" class="block text-sm font-medium text-gray-700">Nome:</label>
                        <input type="text" id="update-name" name="name" 
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label for="update-constellation" class="block text-sm font-medium text-gray-700">Constelação:</label>
                        <input type="text" id="update-constellation" name="constellation" 
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label for="update-race" class="block text-sm font-medium text-gray-700">Raça:</label>
                        <input type="text" id="update-race" name="race" 
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label for="update-description" class="block text-sm font-medium text-gray-700">Descrição:</label>
                        <textarea id="update-description" name="description" 
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"></textarea>
                    </div>
                    <div>
                        <label for="update-img1" class="block text-sm font-medium text-gray-700">Imagem 1:</label>
                        <input type="file" id="update-img1" name="img1" accept="image/*" 
                               class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                    </div>
                    <div>
                        <label for="update-img2" class="block text-sm font-medium text-gray-700">Imagem 2:</label>
                        <input type="file" id="update-img2" name="img2" accept="image/*" 
                               class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                    </div>

                    <button type="submit" 
                            class="w-full bg-yellow-600 text-white py-2 px-4 rounded-md hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2">
                        Atualizar Personagem
                    </button>
                </form>
            </div>
        </section>

        <!-- Seção Deletar -->
        <section id="deletar" class="tab-content">
            <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-sm p-8">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">Deletar Todos os Personagens</h2>
                <div class="text-center">
                    <button id="delete-all-button" 
                            class="bg-red-600 text-white py-3 px-8 rounded-lg 
                            hover:bg-red-700 transition-colors duration-200">
                        Deletar Todos os Personagens
                    </button>
                </div>
            </div>
        </section>
    </div>

    <script>
        const apiUrl = 'https://orvapi.onrender.com';

        function showToast(message, type = 'success') {
            Toastify({
                text: message,
                duration: 3000,
                gravity: "top",
                position: "right",
                backgroundColor: type === 'success' ? "#4CAF50" : "#f44336"
            }).showToast();
        }

        // Função para gerenciar as tabs
        function showTab(tabId) {
            // Esconde todas as tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove a classe active de todos os botões
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Mostra a tab selecionada
            document.getElementById(tabId).classList.add('active');
            
            // Adiciona a classe active ao botão selecionado
            document.querySelector([data-tab="${tabId}"]).classList.add('active');
        }

        // Mostra a primeira tab por padrão
        showTab('adicionar');

        // Função para criar um personagem
        document.getElementById('add-character-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData();
            formData.append('name', document.getElementById('name').value);
            formData.append('constellation', document.getElementById('constellation').value);
            formData.append('race', document.getElementById('race').value);
            formData.append('description', document.getElementById('description').value);
            formData.append('img1', document.getElementById('img1').files[0]);
            formData.append('img2', document.getElementById('img2').files[0]);

            try {
                const response = await fetch(${apiUrl}/characters, {
                    method: 'POST',
                    body: formData,
                });
                const data = await response.json();
                showToast('Personagem adicionado com sucesso');
                e.target.reset();
            } catch (error) {
                console.error('Erro ao adicionar personagem:', error);
                showToast('Erro ao adicionar personagem', 'error');
            }
        });

        // Função para buscar personagens
        document.getElementById('search-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const name = document.getElementById('search-name').value;
            const queryString = name ? ?name=${name} : '';

            try {
                const response = await fetch(${apiUrl}/characters${queryString});
                const characters = await response.json();
                const charactersList = document.getElementById('characters-list');
                charactersList.innerHTML = '';
                characters.forEach(character => {
                    const li = document.createElement('li');
                    li.className = 'p-3 bg-gray-50 rounded-md';
                    li.textContent = ID: ${character.id}, Nome: ${character.name};
                    charactersList.appendChild(li);
                });
            } catch (error) {
                console.error('Erro ao buscar personagens:', error);
                showToast('Erro ao buscar personagens', 'error');
            }
        });

        // Função para atualizar um personagem
        document.getElementById('update-character-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData();
            formData.append('name', document.getElementById('update-name').value);
            formData.append('constellation', document.getElementById('update-constellation').value);
            formData.append('race', document.getElementById('update-race').value);
            formData.append('description', document.getElementById('update-description').value);
            formData.append('img1', document.getElementById('update-img1').files[0]);
            formData.append('img2', document.getElementById('update-img2').files[0]);

            const id = document.getElementById('update-id').value;
            
            try {
                const response = await fetch(${apiUrl}/characters/${id}, {
                    method: 'PUT',
                    body: formData,
                });
                const data = await response.json();
                showToast('Personagem atualizado com sucesso');
                e.target.reset();
            } catch (error) {
                console.error('Erro ao atualizar personagem:', error);
                showToast('Erro ao atualizar personagem', 'error');
            }
        });

        // Função para deletar todos os personagens
        document.getElementById('delete-all-button').addEventListener('click', async () => {
            if (!confirm('Tem certeza que deseja deletar todos os personagens?')) return;
            
            try {
                const response = await fetch(${apiUrl}/characters/delete-all, {
                    method: 'DELETE',
                });
                const data = await response.json();
                showToast(data.message);
            } catch (error) {
                console.error('Erro ao deletar personagens:', error);
                showToast('Erro ao deletar personagens', 'error');
            }
        });
    </script>
</body>
</html>